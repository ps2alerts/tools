# Alert Simulator

This tool is used to generate an alert and stuff it full of dummy data, rather than having to wait for the game to provide it to you and running the whole collection system to start working.

It also enables testing of continents we cannot access, e.g. for Outfitwars.

## outfitwar_match.py

This script simulates a single match. The script has two modes that it can be used in - `fake` mode and `replay` mode. Fake mode generates randomized data for the outfits used for the fake match, while replay mode uses historical data from the various census events endpoints, generated by the outfitwar_replay.py script. In both modes the script first takes a service id for census and then the mode name - fake or replay - and finally various options depending on mode.

### Options

```
Fake mode positional arguments:
service_id                      The service id to use to query census for the team data
                                (outfit members, etc)

Fake mode options:
--red-outfit-id ID, -r ID       Red team's outfit ID
--blue-outfit-id ID, -b ID      Blue team's outfit ID
--world NUM, -w NUM             The world id of the server being simulated (1, 10, 13, 17)
--capture-rate RATE, -c RATE    The number of seconds between base captures
--death-rate RATE, -d RATE      The number of seconds between deaths (can be a decimal, ie 0.5)
--death-delay DELAY, -l DELAY   The number of seconds to delay before sending the first death event

Replay mode positional arguments:
metagame_events_file            File containing 2 metagame events - one start and one end
facility_events_file            File containing facility events for only the instance
                                    detailed by the metagame events
death_events_file               File containing death events for the metagame instance
vehicle_destroy_events_file     File containing vehicle destroy events for the instance
```

### Example usages

To run a fake match on Connery for UN17 and HMRD, where a base is captured every 60 seconds:
`python outfitwar_match.py fake <service-id> -r 37570391403474491 -b 37571208657592881 -w 1 -c 60`

To replay a match after generating the data using the outfitwar_replay.py script:
`python outfitwar_match.py replay metagame_events.json facility_events.json death_events.json vehicle_destroy_events.json`


## outfitwar_replay.py

This script queries the `world_event` and `event` collections on census to retrieve historical data for an outfitwar match and saves it to 4 json files - one for metagame events, facility events, death events, and vehicle destroy events. These can then be fed into the outfitwar_match.py script to replay that metagame instance.

### Options

```
Positional arguments:
service_id                      The service id to use when querying census - do not include 's:'
after                           The unix timestamp or ISO 8601 date immediately before the match
                                    started
before                          The unix timestamp or ISO 8601 date immediately after the match ended
world                           The world which the event was missed on - one of (1, 10, 13, 17, 40)
instance_id                     The exact census instance id that was missed

Options:
--red-outfit-id ID, -r ID       The outfit ID of the red team's outfit
--blue-outfit-id ID, -b ID      The outfit ID of the blue team's outfit
```

### Example usage

To retrieve a missed Miller match from September 9th using AZ time (UTC-7)
`python outfitwar_replay.py <service-id> '2022-09-09T11:19:59-07' '2022-09-09T12:06:00-07' 10 32476`

To retrieve a missed Cobalt match from September 9th using AZ time (UTC-7)
`python outfitwar_replay.py <service-id> '2022-09-09T11:19:59-07' '2022-09-09T12:06:00-07' 13 31774`

To retrieve a missed Miller match where the red team did not cap any bases and needs to be assigned
`python outfitwar_replay.py <service-id> '2022-09-09T11:49:59-07' '2022-09-09T12:36:00-07' 10 32480 -r 37509488620602547`
